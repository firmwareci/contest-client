JobName: QEMU Boot Test
Runs: 1
RunInterval: 60s
Tags: ["coreboot", "qemu", "boot"]
TestDescriptors:
    -   TargetManagerName: TargetList
        TargetManagerAcquireParameters:
          Targets:
              - ID: "1234"
              - ID: "0071"
          MinNumberDevices: 1
          MaxNumberDevices: 1
        TargetManagerReleaseParameters:
        TestFetcherName: literal
        TestFetcherFetchParameters:
            TestName: Build and Boot coreboot
            Steps:
                -   name: cmd
                    label: Delete local Files coreboot
                    parameters:
                        executable: [rm]
                        args: ["-rf", "/tmp/coreboot-{{ .ID }}/"]
                -   name: cmd
                    label: Cloning coreboot
                    parameters:
                        executable: [git]
                        args: ["clone","https://github.com/coreboot/coreboot.git", "/tmp/coreboot-{{ .ID }}/"]
                        expect: ["Cloning into"]
                -   name: cmd
                    label: Cloning submodules
                    parameters:
                        executable: [git]
                        args: ["submodule","update", "--checkout", "--init"]
                        dir: ["/tmp/coreboot-{{ .ID }}/"]
                        expect: ["Cloning into"]
                -   name: cmd
                    label: Config into coreboot folder
                    parameters:
                        executable: [cp]
                        args: ["configs/config.emulation_qemu_x86_i440fx", "configs/defconfig"]
                        dir: ["/tmp/coreboot-{{ .ID }}/"]
                -   name: cmd
                    label: Creating the .config file
                    parameters:
                        executable: [make]
                        args: ["defconfig"]
                        dir: ["/tmp/coreboot-{{ .ID }}/"]
                        expect: ["configuration written to"]
                -   name: cmd
                    label: Building the toolchain
                    parameters:
                        executable: [make]
                        args: ["crossgcc-i386","CPUS=16"]
                        dir: ["/tmp/coreboot-{{ .ID }}/"]
                        expect: ["You can now run IASL ACPI compiler from"]
                -   name: cmd
                    label: Build coreboot
                    parameters:
                        executable: [make]
                        dir: ["/tmp/coreboot-{{ .ID }}/"]
                -   name: cmd
                    label: Copy qemu script
                    parameters:
                        executable: [cp]
                        args: ["/root/go/src/github.com/firmwareci/contest-client/assets/qemu_script.sh", "."]
                        dir: ["/tmp/coreboot-{{ .ID }}/"]
                -   name: cmd
                    label: emulate coreboot
                    parameters:
                        executable: [sh]
                        args: ["qemu_script.sh"]
                        dir: ["/tmp/coreboot-{{ .ID }}/"]
                        expect: ["Jumping to boot code"]
                        timeout: ["5m"]

Reporting:
    RunReporters:
        -   name: TargetSuccess
            parameters:
                SuccessExpression: "=100%"
